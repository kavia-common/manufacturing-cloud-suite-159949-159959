{"is_source_file": true, "format": "Python", "description": "This file defines a class `ProductionService` that manages production-related operations, including creating work orders and computing KPI snapshots. It handles database interactions, publishes real-time events, and integrates with various repositories and schemas.", "external_files": ["src/db/models/production.py", "src/repositories/production.py", "src/schemas/production.py", "src/schemas/realtime.py", "src/services/base.py", "src/services/realtime.py"], "external_methods": ["broadcast_manager.publish_scheduler_event", "broadcast_manager.publish_kpi_snapshot", "WorkOrderRepository.create_work_order", "session.execute", "select", "func.coalesce", "KpiSnapshot"], "published": ["ProductionService"], "classes": [{"name": "ProductionService", "description": "A domain service class that manages production operations, including creating work orders and generating KPI snapshots, with real-time broadcasting capabilities."}], "methods": [{"name": "WorkOrder create_work_order(self, payload: WorkOrderCreate, tenant_id: UUID)", "description": "Creates a new work order, then broadcasts scheduler and KPI updates.", "scope": "ProductionService", "scopeKind": "class"}, {"name": "KpiSnapshot _compute_kpis_snapshot(self)", "description": "Calculates and returns a KPI snapshot including OEE, scrap rate, and downtime minutes.", "scope": "ProductionService", "scopeKind": "class"}, {"name": "None __init__(self, session: AsyncSession)", "scope": "ProductionService", "scopeKind": "class", "description": "unavailable"}], "calls": ["self.wo_repo.create_work_order", "broadcast_manager.publish_scheduler_event", "broadcast_manager.publish_kpi_snapshot", "self.session.execute", "select", "func.coalesce", "WorkOrderOperation.quantity_good", "WorkOrderOperation.quantity_scrap", "ProductionLog.duration_minutes", "ProductionLog.log_type", "KpiSnapshot"], "search-terms": ["ProductionService", "create_work_order", "compute_kpis_snapshot", "broadcast_manager", "WorkOrderRepository", "KpiSnapshot", "asyncio", "OEE", "KPIs", "production"], "state": 2, "file_id": 59, "knowledge_revision": 154, "git_revision": "d274571abc5df5a6a7e6a000b418bfffb7011d0b", "revision_history": [{"144": ""}, {"154": "d274571abc5df5a6a7e6a000b418bfffb7011d0b"}], "ctags": [{"_type": "tag", "name": "ProductionService", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/production.py", "pattern": "/^class ProductionService(BaseService):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/production.py", "pattern": "/^    def __init__(self, session: AsyncSession) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, session: AsyncSession)", "scope": "ProductionService", "scopeKind": "class"}, {"_type": "tag", "name": "_compute_kpis_snapshot", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/production.py", "pattern": "/^    async def _compute_kpis_snapshot(self) -> KpiSnapshot:$/", "language": "Python", "typeref": "typename:KpiSnapshot", "kind": "member", "signature": "(self)", "scope": "ProductionService", "scopeKind": "class"}, {"_type": "tag", "name": "create_work_order", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/production.py", "pattern": "/^    async def create_work_order(self, payload: WorkOrderCreate, tenant_id: UUID) -> WorkOrder:$/", "language": "Python", "typeref": "typename:WorkOrder", "kind": "member", "signature": "(self, payload: WorkOrderCreate, tenant_id: UUID)", "scope": "ProductionService", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/production.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}], "hash": "1c680b2e034dc84eaa4fdc5242278f78", "format-version": 4, "code-base-name": "manufacturing_api", "filename": "manufacturing_api/src/services/production.py", "fields": [{"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}]}