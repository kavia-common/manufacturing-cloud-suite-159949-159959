{"is_source_file": true, "format": "Python", "description": "Main application module for a FastAPI-based manufacturing API. It initializes the FastAPI app, sets up middleware, configures startup events for database migration and seeding, defines health check and WebSocket endpoints, and registers API routers related to authentication, user management, roles, inventory, procurement, production, master data, quality, and scheduling. It also includes WebSocket endpoints for real-time KPIs and collaborative scheduling, with token validation and message rebroadcasting via a broadcast manager.", "external_files": ["src.core.settings", "src.core.deps", "src.core.security", "src.db.run_migrations", "src.db.seed", "src.schemas.common", "src.schemas.realtime", "src.services.realtime", "src.services.production", "src.db.session", "src.api.routes.auth", "src.api.routes.users", "src.api.routes.roles", "src.api.routes.inventory", "src.api.routes.procurement", "src.api.routes.production", "src.api.routes.master_data", "src.api.routes.quality", "src.api.routes.scheduling"], "external_methods": ["get_app_settings", "get_tenant_id", "decode_token", "main", "seed_all", "BroadcastManager.dashboard_topic", "BroadcastManager.scheduler_topic", "BroadcastManager.connect", "BroadcastManager.broadcast", "BroadcastManager.disconnect", "ProductionService._compute_kpis_snapshot", "async_sessionmaker", "get_engine"], "published": ["health_check", "tenant_health_echo", "websocket_info", "_validate_ws_and_get_user", "ws_dashboard", "ws_scheduler"], "classes": [{"name": "WsEnvelope", "description": "Data model for WebSocket message envelope, encapsulating message type, payload, channel, and timestamp."}], "methods": [{"name": "tuple[str,str] _validate_ws_and_get_user(websocket: WebSocket)", "description": "Validates WebSocket connection by verifying JWT token and tenant ID header, returns tenant_id and user_id if valid.", "scope": "", "scopeKind": ""}, {"name": "ws_dashboard(websocket: WebSocket)", "description": "WebSocket endpoint for real-time KPI dashboard updates; sends initial KPI snapshot and keeps connection alive.", "scope": "", "scopeKind": ""}, {"name": "ws_scheduler(websocket: WebSocket)", "description": "WebSocket endpoint for real-time collaboration on scheduler data; handles message rebroadcasting and KPI updates.", "scope": "", "scopeKind": ""}, {"name": "MessageResponse health_check()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "None on_startup()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "TenantEcho tenant_health_echo(tenant_id=Depends(get_tenant_id))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Any] websocket_info()", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["get_app_settings", "get_tenant_id", "decode_token", "run_alembic", "seed_all", "broadcast_manager.dashboard_topic", "broadcast_manager.scheduler_topic", "broadcast_manager.connect", "broadcast_manager.broadcast", "broadcast_manager.disconnect", "ProductionService._compute_kpis_snapshot", "get_engine"], "search-terms": ["FastAPI", "WebSocket endpoints", "KPI snapshot", "broadcast_manager", "schedule.update", "tenant health", "database migration", "seeding", "production service", "collaborative scheduler"], "state": 2, "file_id": 1, "knowledge_revision": 152, "git_revision": "090983a3b6b55ceade1c4fe9954386f020440297", "revision_history": [{"6": "f64d9862d7b83a0942d77423126ce41003234ad8"}, {"76": "f64d9862d7b83a0942d77423126ce41003234ad8"}, {"77": "06068ff228e7e597e70061c7ebfce1a73fe861df"}, {"97": "06068ff228e7e597e70061c7ebfce1a73fe861df"}, {"98": "06068ff228e7e597e70061c7ebfce1a73fe861df"}, {"134": "6b81cec3a8cad681a0fc61e8bb08e1a1a42f0473"}, {"135": "6b81cec3a8cad681a0fc61e8bb08e1a1a42f0473"}, {"136": "6b81cec3a8cad681a0fc61e8bb08e1a1a42f0473"}, {"145": "090983a3b6b55ceade1c4fe9954386f020440297"}, {"146": "090983a3b6b55ceade1c4fe9954386f020440297"}, {"147": "090983a3b6b55ceade1c4fe9954386f020440297"}, {"152": "090983a3b6b55ceade1c4fe9954386f020440297"}], "ctags": [{"_type": "tag", "name": "_tenant_context", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^            from src.db.session import tenant_context as _tenant_context$/", "file": true, "language": "Python", "kind": "unknown", "scope": "ws_dashboard", "scopeKind": "function", "nameref": "unknown:tenant_context"}, {"_type": "tag", "name": "_tenant_context", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^            from src.db.session import tenant_context as _tenant_context$/", "file": true, "language": "Python", "kind": "unknown", "scope": "ws_scheduler", "scopeKind": "function", "nameref": "unknown:tenant_context"}, {"_type": "tag", "name": "_validate_ws_and_get_user", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^async def _validate_ws_and_get_user(websocket: WebSocket) -> tuple[str, str]:$/", "language": "Python", "typeref": "typename:tuple[str,str]", "kind": "function", "signature": "(websocket: WebSocket)"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "auth_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.auth import router as auth_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^def health_check() -> MessageResponse:$/", "language": "Python", "typeref": "typename:MessageResponse", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "inventory_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.inventory import router as inventory_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "masterdata_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.master_data import router as masterdata_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "on_startup", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^async def on_startup() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "openapi_tags", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^openapi_tags = [$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "procurement_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.procurement import router as procurement_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "production_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.production import router as production_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "quality_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.quality import router as quality_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "roles_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.roles import router as roles_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "run_alembic", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.db.run_migrations import main as run_alembic$/", "language": "Python", "kind": "unknown", "nameref": "unknown:main"}, {"_type": "tag", "name": "scheduling_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.scheduling import router as scheduling_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "settings", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^settings = get_app_settings()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "tenant_health_echo", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^async def tenant_health_echo(tenant_id=Depends(get_tenant_id)) -> TenantEcho:$/", "language": "Python", "typeref": "typename:TenantEcho", "kind": "function", "signature": "(tenant_id=Depends(get_tenant_id))"}, {"_type": "tag", "name": "users_router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^from src.api.routes.users import router as users_router$/", "language": "Python", "kind": "unknown", "nameref": "unknown:router"}, {"_type": "tag", "name": "websocket_info", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^def websocket_info() -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "ws_dashboard", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^async def ws_dashboard(websocket: WebSocket):$/", "language": "Python", "kind": "function", "signature": "(websocket: WebSocket)"}, {"_type": "tag", "name": "ws_scheduler", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/main.py", "pattern": "/^async def ws_scheduler(websocket: WebSocket):$/", "language": "Python", "kind": "function", "signature": "(websocket: WebSocket)"}], "hash": "bc4641a8e364458f3e86bd61af24c206", "format-version": 4, "code-base-name": "manufacturing_api", "filename": "manufacturing_api/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "openapi_tags = [", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "settings = get_app_settings()", "scope": "", "scopeKind": "", "description": "unavailable"}]}