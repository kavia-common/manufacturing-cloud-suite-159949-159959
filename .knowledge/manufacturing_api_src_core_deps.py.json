{"is_source_file": true, "format": "Python", "description": "This file contains core dependencies and utility functions for handling tenant identification, user authentication, session management, and role-based access control within a FastAPI application, specific to a multi-tenant cloud manufacturing suite.", "external_files": ["src.core.security", "src.db.session", "src.repositories.security"], "external_methods": ["decode_token", "get_async_session", "tenant_context", "SecurityRepository.get_user_by_id", "SecurityRepository.list_roles_for_user"], "published": ["get_tenant_id", "get_tenant_session", "get_session_no_tenant", "get_current_user", "get_current_active_user", "require_roles"], "classes": [{"name": "SecurityRepository", "description": "Repository class responsible for security-related database operations such as fetching user data and roles."}], "methods": [{"name": "UUID get_tenant_id(x_tenant_id: str | None = Header(default=None, alias=\"X-Tenant-ID\"))", "description": "Extracts and validates the tenant ID from the X-Tenant-ID header, raising HTTP 400 if missing or invalid.", "scope": "", "scopeKind": ""}, {"name": "AsyncGenerator[AsyncSession,None] get_tenant_session( tenant_id: UUID = Depends(get_tenant_id), session_dep=Depends(get_async_session), )", "description": "Provides an async generator yielding a database session with tenant context set, enabling row-level security for the specified tenant.", "scope": "", "scopeKind": ""}, {"name": "AsyncGenerator[AsyncSession,None] get_session_no_tenant( session_dep=Depends(get_async_session), )", "description": "Provides an async generator yielding a database session without tenant context, suitable for system-level or manual tenant context management.", "scope": "", "scopeKind": ""}, {"name": "get_current_user( tenant_id: UUID = Depends(get_tenant_id), token: str = Depends(oauth2_scheme), session: AsyncSession = Depends(get_tenant_session), )", "description": "Validates and decodes the incoming bearer token, checks tenant consistency, and retrieves the user object within the tenant scope.", "scope": "", "scopeKind": ""}, {"name": "get_current_active_user(user=Depends(get_current_user))", "description": "Ensures the current user is active.", "scope": "", "scopeKind": ""}, {"name": "require_roles(*required: str)", "description": "Creates a dependency that enforces user has at least one of the specified roles.", "scope": "", "scopeKind": ""}, {"name": "_dep(user=Depends(get_current_active_user), session: AsyncSession = Depends(get_tenant_session))", "scope": "require_roles", "scopeKind": "function", "description": "unavailable"}], "calls": ["decode_token", "get_async_session", "tenant_context", "SecurityRepository(session).get_user_by_id", "SecurityRepository(session).list_roles_for_user"], "search-terms": ["get_tenant_session", "get_current_user", "oauth2_scheme", "row-level security", "tenant context", "role-based access"], "state": 2, "file_id": 26, "knowledge_revision": 164, "git_revision": "6b81cec3a8cad681a0fc61e8bb08e1a1a42f0473", "revision_history": [{"59": ""}, {"95": "06068ff228e7e597e70061c7ebfce1a73fe861df"}, {"96": "06068ff228e7e597e70061c7ebfce1a73fe861df"}, {"164": "6b81cec3a8cad681a0fc61e8bb08e1a1a42f0473"}], "ctags": [{"_type": "tag", "name": "_dep", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^    async def _dep(user=Depends(get_current_active_user), session: AsyncSession = Depends(get_te/", "file": true, "language": "Python", "kind": "function", "signature": "(user=Depends(get_current_active_user), session: AsyncSession = Depends(get_tenant_session))", "scope": "require_roles", "scopeKind": "function"}, {"_type": "tag", "name": "get_current_active_user", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^async def get_current_active_user(user=Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(user=Depends(get_current_user))"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^async def get_current_user($/", "language": "Python", "kind": "function", "signature": "( tenant_id: UUID = Depends(get_tenant_id), token: str = Depends(oauth2_scheme), session: AsyncSession = Depends(get_tenant_session), )"}, {"_type": "tag", "name": "get_session_no_tenant", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^async def get_session_no_tenant($/", "language": "Python", "typeref": "typename:AsyncGenerator[AsyncSession,None]", "kind": "function", "signature": "( session_dep=Depends(get_async_session), )"}, {"_type": "tag", "name": "get_tenant_id", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^async def get_tenant_id(x_tenant_id: str | None = Header(default=None, alias=\"X-Tenant-ID\")) -> /", "language": "Python", "typeref": "typename:UUID", "kind": "function", "signature": "(x_tenant_id: str | None = Header(default=None, alias=\"X-Tenant-ID\"))"}, {"_type": "tag", "name": "get_tenant_session", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^async def get_tenant_session($/", "language": "Python", "typeref": "typename:AsyncGenerator[AsyncSession,None]", "kind": "function", "signature": "( tenant_id: UUID = Depends(get_tenant_id), session_dep=Depends(get_async_session), )"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "oauth2_scheme", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"\\/api\\/v1\\/auth\\/login\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "require_roles", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/core/deps.py", "pattern": "/^def require_roles(*required: str):$/", "language": "Python", "kind": "function", "signature": "(*required: str)"}], "hash": "daff6f2f6eedd2828dc04aaad242bff9", "format-version": 4, "code-base-name": "manufacturing_api", "filename": "manufacturing_api/src/core/deps.py", "fields": [{"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"\\/api\\/v1\\/auth\\/login\")", "scope": "", "scopeKind": "", "description": "unavailable"}]}