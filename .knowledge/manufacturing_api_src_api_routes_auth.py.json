{"is_source_file": true, "format": "Python", "description": "This source file defines FastAPI route handlers for authentication-related endpoints such as user registration, login, token refresh, logout, and retrieving current user info. It leverages dependencies for database sessions, security helpers for token creation and verification, and interacts with a security repository for user and role management.", "external_files": ["src/core/deps", "src/core/security", "src.repositories.security", "src.schemas.auth"], "external_methods": ["get_tenant_id", "get_tenant_session", "get_current_active_user", "create_access_token", "create_refresh_token", "decode_token", "get_password_hash", "verify_password"], "published": ["router"], "classes": [], "methods": [{"name": "UserRead _user_to_read(user, roles: List[str])", "description": "Converts a user object and roles into a UserRead schema for API response.", "scope": "", "scopeKind": ""}, {"name": "UserRead register_user( payload: RegisterRequest, tenant_id: UUID = Depends(get_tenant_id), session: AsyncSession = Depends(get_tenant_session), )", "description": "Handles user registration, creates a new user, assigns admin role if first user.", "scope": "", "scopeKind": ""}, {"name": "TokenPair login_for_tokens( form_data: OAuth2PasswordRequestForm = Depends(), tenant_id: UUID = Depends(get_tenant_id), session: AsyncSession = Depends(get_tenant_session), )", "description": "Authenticates user and returns access and refresh tokens.", "scope": "", "scopeKind": ""}, {"name": "TokenPair refresh_token( payload: RefreshRequest, tenant_id: UUID = Depends(get_tenant_id), session: AsyncSession = Depends(get_tenant_session), )", "description": "Validates refresh token and issues new access and refresh tokens.", "scope": "", "scopeKind": ""}, {"name": "Message logout()", "description": "Provides a stateless logout acknowledgment.", "scope": "", "scopeKind": ""}, {"name": "UserRead read_current_user( user=Depends(get_current_active_user), session: AsyncSession = Depends(get_tenant_session), )", "description": "Returns current authenticated user profile along with roles.", "scope": "", "scopeKind": ""}], "calls": ["SecurityRepository(session).get_user_by_email", "SecurityRepository(session).create_user", "SecurityRepository(session).count_users", "SecurityRepository(session).get_role_by_name", "SecurityRepository(session).create_role", "SecurityRepository(session).assign_role_to_user", "SecurityRepository(session).list_roles_for_user", "create_access_token", "create_refresh_token", "decode_token", "SecurityRepository(session).get_user_by_id"], "search-terms": ["auth endpoints", "token refresh", "user registration", "role assignment", "FastAPI auth", "JWT token management"], "state": 2, "file_id": 39, "knowledge_revision": 99, "git_revision": "", "revision_history": [{"90": ""}, {"99": ""}], "ctags": [{"_type": "tag", "name": "_user_to_read", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/routes/auth.py", "pattern": "/^def _user_to_read(user, roles: List[str]) -> UserRead:$/", "language": "Python", "typeref": "typename:UserRead", "kind": "function", "signature": "(user, roles: List[str])"}, {"_type": "tag", "name": "login_for_tokens", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/routes/auth.py", "pattern": "/^async def login_for_tokens($/", "language": "Python", "typeref": "typename:TokenPair", "kind": "function", "signature": "( form_data: OAuth2PasswordRequestForm = Depends(), tenant_id: UUID = Depends(get_tenant_id), session: AsyncSession = Depends(get_tenant_session), )"}, {"_type": "tag", "name": "logout", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/routes/auth.py", "pattern": "/^async def logout() -> Message:$/", "language": "Python", "typeref": "typename:Message", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "read_current_user", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/routes/auth.py", "pattern": "/^async def read_current_user($/", "language": "Python", "typeref": "typename:UserRead", "kind": "function", "signature": "( user=Depends(get_current_active_user), session: AsyncSession = Depends(get_tenant_session), )"}, {"_type": "tag", "name": "refresh_token", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/routes/auth.py", "pattern": "/^async def refresh_token($/", "language": "Python", "typeref": "typename:TokenPair", "kind": "function", "signature": "( payload: RefreshRequest, tenant_id: UUID = Depends(get_tenant_id), session: AsyncSession = Depends(get_tenant_session), )"}, {"_type": "tag", "name": "register_user", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/routes/auth.py", "pattern": "/^async def register_user($/", "language": "Python", "typeref": "typename:UserRead", "kind": "function", "signature": "( payload: RegisterRequest, tenant_id: UUID = Depends(get_tenant_id), session: AsyncSession = Depends(get_tenant_session), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/api/routes/auth.py", "pattern": "/^router = APIRouter(prefix=\"\\/auth\", tags=[\"Auth\"])$/", "language": "Python", "kind": "variable"}], "hash": "edc1b8a1bfd23816c8dcb0a6b0dc364f", "format-version": 4, "code-base-name": "manufacturing_api", "filename": "manufacturing_api/src/api/routes/auth.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/auth\", tags=[\"Auth\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}