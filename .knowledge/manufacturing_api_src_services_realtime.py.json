{"is_source_file": true, "format": "Python", "description": "This file implements a WebSocket in-process pub-sub manager for real-time notification broadcasting in a manufacturing cloud API project. It handles WebSocket connections, disconnections, and message broadcasting to specific topics, particularly dashboard and scheduler topics, and publishes KPI snapshots and scheduler events.", "external_files": ["starlette.websockets", "src.schemas.realtime"], "external_methods": ["WebSocket.send_json", "WebSocket.application_state", "WebSocket.client_state"], "published": ["broadcast_manager"], "classes": [{"name": "BroadcastManager", "description": "Manages WebSocket topic subscriptions, broadcasting messages, and publishing KPI snapshots and scheduler events."}], "methods": [{"name": "None __init__(self)", "description": "Initializes the BroadcastManager with topic and lock dictionaries.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "asyncio.Lock _topic_lock(self, topic: str)", "description": "Returns or creates an asyncio.Lock for a specific topic.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "str dashboard_topic(self, tenant_id: UUID | str)", "description": "Generates a topic name string for the dashboard for a given tenant.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "str scheduler_topic(self, tenant_id: UUID | str, board: Optional[str] = None)", "description": "Generates a topic name string for scheduler events for a tenant and optional board.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "None _ensure_topic(self, topic: str)", "description": "Ensures that a topic exists in the internal dictionary, creating it if necessary.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "None connect(self, topic: str, websocket: WebSocket)", "description": "Adds a WebSocket connection to a topic's subscribers.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "None disconnect(self, topic: str, websocket: WebSocket)", "description": "Removes a WebSocket connection from a topic's subscribers.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "None broadcast(self, topic: str, message: dict, exclude: Optional[WebSocket] = None)", "description": "Sends a message to all WebSocket subscribers of a topic, excluding any specified websocket.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "None publish_kpi_snapshot(self, tenant_id: UUID | str, snapshot: KpiSnapshot)", "description": "Wraps a KPI snapshot in an envelope and broadcasts it to the dashboard topic.", "scope": "BroadcastManager", "scopeKind": "class"}, {"name": "None publish_scheduler_event(self, tenant_id: UUID | str, event: SchedulerEvent)", "description": "Wraps a scheduler event in an envelope and broadcasts it to the scheduler topic.", "scope": "BroadcastManager", "scopeKind": "class"}], "calls": ["self._ensure_topic", "self._topic_lock", "ws.send_json", "logger.info", "logger.exception", "self.broadcast", "env.model_dump"], "search-terms": ["WebSocket", "pub-sub", "dashboard", "scheduler", "KpiSnapshot", "SchedulerEvent", "broadcast_manager", "asyncio.Lock", "topics"], "state": 2, "file_id": 58, "knowledge_revision": 142, "git_revision": "", "ctags": [{"_type": "tag", "name": "BroadcastManager", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^class BroadcastManager:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    def __init__(self) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "_ensure_topic", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    async def _ensure_topic(self, topic: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, topic: str)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "_topic_lock", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    def _topic_lock(self, topic: str) -> asyncio.Lock:$/", "language": "Python", "typeref": "typename:asyncio.Lock", "kind": "member", "signature": "(self, topic: str)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "broadcast", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    async def broadcast(self, topic: str, message: dict, exclude: Optional[WebSocket] = None) ->/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, topic: str, message: dict, exclude: Optional[WebSocket] = None)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "broadcast_manager", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^broadcast_manager = BroadcastManager()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    async def connect(self, topic: str, websocket: WebSocket) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, topic: str, websocket: WebSocket)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "dashboard_topic", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    def dashboard_topic(self, tenant_id: UUID | str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, tenant_id: UUID | str)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "disconnect", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    async def disconnect(self, topic: str, websocket: WebSocket) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, topic: str, websocket: WebSocket)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "publish_kpi_snapshot", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    async def publish_kpi_snapshot(self, tenant_id: UUID | str, snapshot: KpiSnapshot) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, tenant_id: UUID | str, snapshot: KpiSnapshot)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "publish_scheduler_event", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    async def publish_scheduler_event(self, tenant_id: UUID | str, event: SchedulerEvent) -> Non/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, tenant_id: UUID | str, event: SchedulerEvent)", "scope": "BroadcastManager", "scopeKind": "class"}, {"_type": "tag", "name": "scheduler_topic", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159959/manufacturing_api/src/services/realtime.py", "pattern": "/^    def scheduler_topic(self, tenant_id: UUID | str, board: Optional[str] = None) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(self, tenant_id: UUID | str, board: Optional[str] = None)", "scope": "BroadcastManager", "scopeKind": "class"}], "hash": "9170c134fe3cd967ccd77333cfb9201f", "format-version": 4, "code-base-name": "manufacturing_api", "filename": "manufacturing_api/src/services/realtime.py", "fields": [{"name": "broadcast_manager = BroadcastManager()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"142": ""}]}